<!DOCTYPE html>
<html lang="en">

<head>
    <title>Hello!</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>

<body>
    <h1>Lab 6 / React</h1>

    <div id="root"></div>

    <script type="text/babel">
        class Counter extends React.Component{
        constructor(props){
          super(props)
          this.state = {
          
          }
        }
      }
    
      class Card extends React.Component {
        constructor(props){
          super(props)
          this.state = {
          
          }
        }
                
        clicked(card){
          this.props.click(card)
        }
        
        
        render (){
        const { card } = this.props;
                
        const x = card.index%4+1;
        const y = card.index%4+1;
        
        
          const styleBack = {
            backgroundColor: 'red',
            width: '60%',
            height: '110px',
            position: 'absolute',
            left: '0px',
            textAlign: 'center',
            borderRadius: '10px',
            gridColumn: `${x}/${x}`,
            gridRow: `${y}`
          }
          
          const styleFront = {
            
          }
                    
        
        return (
          <div onClick={() => this.clicked(card)}>
            <div style={styleFront}>
            
            </div>
            <div style={styleBack}>
            {card.text}
            </div>
          </div>
        )
        }
            
      }

      
      class Game extends React.Component {
        constructor(props) {
          super(props)
          
          this.cards = ['card1', 'card2', 'card3', 'card4', 'card5', 'card6', 'card7', 'card8']
          this.cardList = []
          
          this.state = {
            
            activeCards: []
          }
          
          
          
          this.startGame()
        }
        
        startGame() {
          let randomizedCards = []
        
          // Agregar dos veces las cartas originales
          randomizedCards = this.cards.concat(this.cards)
          
          // Randomizar las 10 cartas totales
          randomizedCards = this.shuffle(randomizedCards)
          
          this.cardList = []
          
          
          randomizedCards.forEach(
          (i, index) => {
            this.cardList.push({
              index: index,
              flipped: false,
              solved: false,
              text: i,
              imgSrc: i + '.png'
            })
          }
          )
      
          
        
        }
        
        
        onClick(name, index) {
          let card = {name, index}
          let cardList = this.cardList
          let activeCards = this.state.activeCards
          
          cardList[index].flipped = true
          activeCards.push(card)
          
          
          
          if (activeCards.length == 2){
            setTimeout(() => {
              this.checkCards();
            },
            1000)
          }
          
          
          
        
        }
        
        checkCards() {
          let cardList = this.cardList
          let activeCards = this.state.activeCards
          
          
          
          if ((activeCards[0].index != activeCards[1].index) && (activeCards[0].text == activeCards[1].text)) {
            console.log("asd")
          }
          
          this.setState({activeCards : []})
        
        }
        
        // Extraido de stackoverflow
        // https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
        shuffle(array){
          let currentIndex = array.length, temporaryValue, randomIndex;
          while (0 !== currentIndex) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex -= 1;
            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
          }
          return array
        }
        
        render() {
          const style = {
            backgroundColor: 'purple',
            width: '100%',
            height: '100%',
            position: 'relative',
            display: 'grid',
            gridTemplateColumns: '25% 25% 25% 25%',
            gridTemplateRows: '7em 7em 7em 7em'
          }
          
         
          
          
          return (
            
            <div style={style}>
              {
              this.cardList.map((card, index) => {
                let name = card.text
                return <Card card={card} click={() => {this.onClick(name,index)}}/>
                
              })
              }
            </div>
          )
        }
      }
      
      ReactDOM.render(
        <Game />,
        document.getElementById('root')
      )
    </script>
</body>

</html>